 
Клиент-серверное приложение на С++11, обеспечивающее многопоточный доступ к телефооной базе данных.

## Постановка задачи
### Часть 1: Генерирование исходных данных.

Требуется сгенерировать файл в формате csv, содержащий 3 поля:
1. Номер телефона
2. ФИО
3. Логический признак активности абонента (используется номер или отключен)

Данные должны быть сгенерированы случайным образом, размер файла примерно 1Гб.

### Часть 2: Программа для работы с файлом.

Программа читает сгененированный в первой задаче файл в память.
Функционал программы должен позволять выполнять HTTP-запросы двух типов:
1. По номеру телефона вывести ФИО и признак активности абонента
2. Вывести номера телефонов и ФИО всех активных абонентов
Время выполнения каждого запроса и время чтения файла должно быть отражено в логе (в миллисекундах)
Программа должна быть реализована на языке С++. В качестве библиотеки для HTTP-сервера можно использовать https://github.com/yhirose/cpp-httplib
Решение можно объединить в один код, но в разных функциях или объектах. Предпочтительно написание под Linux.

## Структура базы данных
Для решения поставленной задачи предлагается разработать клиент-серверное приложение. На стороне клиента программа должна формировать http-запросы для выполнения генерации исходных данных, вывода по телефонному номеру ФИО и признака активности абонента, а также вывода телефонного номера и ФИО всех активных абонентов. На стороне сервера приложение должно формировать http-ответы на данные запросы.

Выбор структуры базы данных определяется возможностью безопасного доступа к ней из нескольких потоков, а также ее большим размером.

Для обеспечения быстрого доступа к элементам базы данных (записям) для поиска, модификации, удаления целесообразно осуществлять их хранение в стандартном контейнере (например, std::map<>). Однако, учитывая большой объем хранимых элементов (1Гб данных примерно соответствует 15 млн записям с размером ~60 байт), доступ к стандартному контейнеру std::map<> будет очень длительным, а при использовании контейнера std::vector<> крайне вероятно, что операционная система не сможет выделить под него достаточное количество непрерывной памяти. В силу этого предлагается реализовать двухуровневую структуру базы данных: в std::vector<> хранить контейнеры std::map<>, в которых хранить элементы базы данных.

В качестве ключа, по которому осуществляется доступ к элементам базы данных, целесообразно использовать телефонный номер абонента. В этом случае первые n-цифр номера (за исключением “8”) соответствуют индексу вектора, в котором находится std::map<>, содержащий запись со второй частью телефонного номера. Элементом базы данных является структура, содержащая три поля типа std::string: фамилия, имя и отчество. Для кодирования признака активности элементы базы данных помещаются в разные вектора с активными и неактивными абонентами, что увеличивает упорядочность в базе данных и позволяет более быстро осуществлять операции доступа к элементам (время же генерации, загрузки базы данных за счет поддержания частичного порядка будет увеличено).

Безопасность обращения к базе данных со стороны как читающих потоков, так и потоков, записывающих информацию в базу данных, обеспечивается за счет применения разработанной потокобезопасной оболочки для стандартного контейнера std::map<>. Доступ к нему при операциях чтения осуществляется в многопоточном режиме под защитой блокировки boost::shared_lock<boost::shared_mutex> lock(mutex), а при операциях записи – под защитой блокировки с монопольным доступом std::lock_guard<boost::shared_mutex> lock(mutex).

База данных реализована в виде шаблонного класса, позволяющего хранить элементы пользовательского типа с любым типа ключа (в программе в качестве ключа используется только строковое представление телефонного номера). Хэш-объект преобразует ключ в два числа, соответствующих номеру в векторе и номеру в ассоциативном массиве, по которым и осуществляется доступ к элементу базы данных.


## Интерфейс базы данных
Для обеспечения информационного объмена с телефонной базой данных разработан сервер, позволяющий осуществлять следующие операции:
1. генерация базы данных в m потоков, состоящей из N записей;
2. сохранение базы данных на диск в формате .csv в m файлов;
3. загрузка базы данных с диска из  m .csv-файлов;
4. полное удаление базы данных из памяти;
5. добавление одной записи в базу данных;
6. удаление одной записи из базы данных;
7. поиск записи в базе данных;
8. вывод всех активных, либо неактивных абонентов.

Данные операции, а также их параметры формируются приложением клиента и посылаются в виде http-запроса серверу. После обработки, сервер возвращяет клиенту результат выполнения запроса и время его выполнения на сервере. Клиент также регистрирует полное время выполнения запроса и фиксирует эту информацию в логе (выводит ее в консоль).

## Тестирование клиент-серверного приложения
Тестирование программы произведено с двух компьютеров, находящихся в локальной сети и соединенных по WiFi.
С клиенской машины последовательно сформированны и посланы все возможные запросы к серверу; корректность принятых ответов контролировались. В таблице приведены
запросы, ответы и времена их выполнения. Тестирование произведено под управлением windows 10, однако клиент/серверная программа может быть собрана под Linux.

| №  |          Запрос                 |               Ответ                                     |  Серверное время выполнения запроса  |  Клиентское время выполнения запроса | 
| :--| :------------------------------ | :------------------------------------------------------ | :----------------------------------- | :----------------------------------- |
| 1  | Генерация базы данных           |Count of records: 18000000. Count of bytes: 1015552510.  |             7156.65 mc               |               7232.12 mc             |
| 2  | Сохранение базы данных          |DataBase loaded successfully. Count of records: 18000000.|            24215.85 mc               |              24485.85 mc             |
| 3  | Полное удаление базы данных     |DataBase erased successfully.                            |             2309.41 mc               |               2357.03 mc             |
| 4  | Загрузка базы данных            |DataBase loaded successfully. Count of records: 18000000.|            59820.85 mc               |              59866.85 mc             |
| 5  | Поиск записи в базы данных      |Record not found.                                        |             0.09740 mc               |               51.0106 mc             |
| 6  | Добавление записи в базу данных |New record added successfully.                           |             0.09870 mc               |               48.0731 mc             |
| 7  | Поиск записи в базы данных      |Record found successfully.                               |             0.01210 mc               |               49.5260 mc             |
| 8  | Удаление записи из базы данных  |Record deleted successfully.                             |             0.01150 mc               |               47.9107 mc             |
| 9  | Поиск записи в базы данных      |Record not found.                                        |             0.01011 mc               |               50.2279 mc             |
| 10 | Вывод всех активных абонентов   |Received data were saved successfully.                   |           137418.91 mc               |             137472.00 mc             |
 
 В процессе тестирования размер базы данных составил 1015552510 байт (18 млн записей) без учета использующегося телефонного номера в качестве индекса (учет телефонного номера 18 млн абонентов даст дополнительно ~170мБ в общем объеме базы данных). Операции выполнялись сервером в четыре потока, кроме последней операции вывода всех активных абонентов (эта операция выполнялась в один поток).
 Операция чтения базы данных с диска в память осуществляется намного медленнее, чем операция сохранения на диск, так как структура база данных поддерживает порядок элементов и при добавлении элементов неоходимо осуществлять операции не только вставки элемента, но и его поиска в массивах, соответсвующим активным и неактивным абонентам.
 Благодаря разработанной структуре базы данных поиск, вставка и удаление элемента осуществляются за малое и примерно постоянное время около 0.01 мс.
